<?xml version='1.0' encoding="UTF-8"?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi' xmlns:util='http://schemas.microsoft.com/wix/UtilExtension'
     xmlns:fire="http://schemas.microsoft.com/wix/FirewallExtension">

    <!--
        Variable references:
            $(var.*) are passed in on the command line from the Ant script (see -d arguments to candle)
            !(loc.*) are defined in Brackets_<locale>.wxl
            [*] are references to other elements within this file
    -->

    <!-- note: products with matching `UpgradeCode` guid will be upgraded in-place.  Consequently,
                do not change this guid unless you are starting a new major version of the product. -->
    <Product Id='*' UpgradeCode='A4BAFFF9-7E24-42C2-A808-C821D388B8AD' Name='!(loc.ProductName)' Language='1033'
             Version='$(var.ProductVersionNumber)' Manufacturer='$(var.ProductManufacturer)'  >

        <Package Description='!(loc.ProductName)' Comments='Installer for !(loc.ProductName)'
                 Manufacturer='$(var.ProductManufacturer)' InstallerVersion='300' Compressed='yes'
                 Languages="1033,1036"/>

        <Media Id='1' Cabinet='product.cab' EmbedCab='yes' />

        <!-- defines upgrade experience for all releases related by the same UpgradeCode (above) -->
        <MajorUpgrade Schedule="afterInstallInitialize"
                      DowngradeErrorMessage="A later version of !(loc.ProductName) is already installed.  Setup will now exit." />

        <Property Id="ARPPRODUCTICON" Value="appicon.ico"/>
        <Icon Id="appicon.ico" SourceFile="appicon.ico"/>
        <Property Id="ALLUSERS" Value="1" />

        <DirectoryRef Id="INSTALLDIR" />

        <DirectoryRef Id="ProgramMenuFolder">
            <Component Id="StartMenuShortcut" Guid="{690479C7-3E3B-4370-B5D0-20046794CE8D}" Win64="no" >
                <Shortcut Id="AppShortcut" Name="!(loc.ProductName)" Description="!(loc.ShortcutDescription)"
                          Target="[INSTALLDIR]\$(var.ExeName).exe" />
                <RegistryValue Root="HKCU" Key="Software\$(var.RegistryRoot)" Name="installed" Type="integer"
                               Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>

        <Component Id="FileAssociations" Guid="{BB87F6B3-C8A4-43C2-98D2-BAD2E5968F6A}" Directory="INSTALLDIR" KeyPath="yes">
            <!-- Capabilities keys for Vista/7 "Set Program Access and Defaults" -->
            <RegistryValue Root="HKLM" Key="SOFTWARE\$(var.RegistryRoot)\Capabilities" Name="ApplicationIcon"
                           Value="[INSTALLDIR]$(var.ExeName).exe,0" Type="string" />
            <RegistryValue Root="HKLM" Key="SOFTWARE\$(var.RegistryRoot)\Capabilities" Name="ApplicationName"
                           Value="!(loc.ProductName)" Type="string" />
            <RegistryValue Root="HKLM" Key="SOFTWARE\RegisteredApplications" Name="!(loc.ProductName)"
                           Value="SOFTWARE\$(var.RegistryRoot)\Capabilities" Type="string" />

            <!-- File associations -->
            <?define SupportedFiletypes=mdj?>

            <?foreach filetype in $(var.SupportedFiletypes)?>
                <!-- associate program with file type -->
                <RegistryValue Root="HKLM" Key="SOFTWARE\$(var.RegistryRoot)\Capabilities\FileAssociations"
                               Value="!(loc.ProductName) FileExt" Name=".$(var.filetype)" Type="string" />

                <!-- associate each supported filetype with application -->
                <RegistryValue Root="HKCR" Key=".$(var.filetype)\OpenWithProgids" Value=""
                               Name="!(loc.ProductName) FileExt" Type="string" />
            <?endforeach?>

            <!-- create ProgId entry -->
            <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\!(loc.ProductName) FileExt\shell\open\command"
                           Value="&quot;[INSTALLDIR]$(var.ExeName).exe&quot; &quot;%1&quot;" Type="string" />
            <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\!(loc.ProductName) FileExt\DefaultIcon"
                           Value="[INSTALLDIR]$(var.ExeName).exe,0" Type="string" />
            <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\!(loc.ProductName) FileExt\shell\open"
                           Name="FriendlyAppName" Value="!(loc.ProductName)" Type="string" />
        </Component>

        <!-- Start Menu Shortcuts-->
        <UIRef Id="WixUI_MyInstallDir" />
        <UIRef Id="WixUI_ErrorProgressText" />

        <!-- Launch app after install -->
<!--
        <Property Id="LAUNCHAPPONEXIT" Value="1" />
        <Property Id="WixShellExecTarget" Value="[#fil7EE01D0693DA0F92C26C5F3007D1BF2C]" />
        <CustomAction Id="LaunchApplication" FileKey="fil7EE01D0693DA0F92C26C5F3007D1BF2C" ExeCommand=""
                      Execute="immediate" Impersonate="yes" Return="asyncNoWait" />
-->
        <UI>
            <Publish Dialog="MyExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>
<!--
            <Publish Dialog="MyExitDialog" Control="Finish" Order="1" Event="DoAction"
                     Value="LaunchApplication">LAUNCHAPPONEXIT=1 and NOT INSTALLED AND NOT REMOVE="ALL"</Publish>
-->
        </UI>

        <!-- Add image assets -->
        <WixVariable Id="WixUIBannerBmp" Value="win_install_banner.jpg" />

        <!--Setup Folder Structure -->
        <Directory Id='TARGETDIR' Name='SourceDir'>
            <Directory Id='ProgramFilesFolder'>
                <Directory Id='INSTALLDIR' Name='!(loc.ShortProductName)'/>
            </Directory>
            <Directory Id="ProgramMenuFolder"/>
        </Directory>

        <!-- Set default install location -->
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
        <!-- Install Files -->
        <Feature Id="MainApplication" Title="Main Application" Level="1">
            <!-- From devmanager.wxs -->
            <ComponentGroupRef Id='BRACKETSHARVESTMANAGER'/>

            <ComponentRef  Id='StartMenuShortcut' />

            <ComponentRef  Id='FileAssociations' />
        </Feature>

        <SetProperty Id="ARPINSTALLLOCATION" Value="[INSTALLDIR]" After="CostFinalize" />
    </Product>
</Wix>

<!-- filD0C88F09CF264F61C7551B69762FB244 -->

